{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.defineProperties = void 0;\nvar assert = require('assert');\nvar ethjsUtil = require('ethjs-util');\nvar rlp = require(\"rlp\");\nvar bytes_1 = require(\"./bytes\");\n/**\n * Defines properties on a `Object`. It make the assumption that underlying data is binary.\n * @param self the `Object` to define properties on\n * @param fields an array fields to define. Fields can contain:\n * * `name` - the name of the properties\n * * `length` - the number of bytes the field can have\n * * `allowLess` - if the field can be less than the length\n * * `allowEmpty`\n * @param data data to be validated against the definitions\n * @deprecated\n */\nexports.defineProperties = function (self, fields, data) {\n  self.raw = [];\n  self._fields = [];\n  // attach the `toJSON`\n  self.toJSON = function (label) {\n    if (label === void 0) {\n      label = false;\n    }\n    if (label) {\n      var obj_1 = {};\n      self._fields.forEach(function (field) {\n        obj_1[field] = \"0x\" + self[field].toString('hex');\n      });\n      return obj_1;\n    }\n    return bytes_1.baToJSON(self.raw);\n  };\n  self.serialize = function serialize() {\n    return rlp.encode(self.raw);\n  };\n  fields.forEach(function (field, i) {\n    self._fields.push(field.name);\n    function getter() {\n      return self.raw[i];\n    }\n    function setter(v) {\n      v = bytes_1.toBuffer(v);\n      if (v.toString('hex') === '00' && !field.allowZero) {\n        v = Buffer.allocUnsafe(0);\n      }\n      if (field.allowLess && field.length) {\n        v = bytes_1.stripZeros(v);\n        assert(field.length >= v.length, \"The field \" + field.name + \" must not have more \" + field.length + \" bytes\");\n      } else if (!(field.allowZero && v.length === 0) && field.length) {\n        assert(field.length === v.length, \"The field \" + field.name + \" must have byte length of \" + field.length);\n      }\n      self.raw[i] = v;\n    }\n    Object.defineProperty(self, field.name, {\n      enumerable: true,\n      configurable: true,\n      get: getter,\n      set: setter\n    });\n    if (field.default) {\n      self[field.name] = field.default;\n    }\n    // attach alias\n    if (field.alias) {\n      Object.defineProperty(self, field.alias, {\n        enumerable: false,\n        configurable: true,\n        set: setter,\n        get: getter\n      });\n    }\n  });\n  // if the constuctor is passed data\n  if (data) {\n    if (typeof data === 'string') {\n      data = Buffer.from(ethjsUtil.stripHexPrefix(data), 'hex');\n    }\n    if (Buffer.isBuffer(data)) {\n      data = rlp.decode(data);\n    }\n    if (Array.isArray(data)) {\n      if (data.length > self._fields.length) {\n        throw new Error('wrong number of fields in data');\n      }\n      // make sure all the items are buffers\n      data.forEach(function (d, i) {\n        self[self._fields[i]] = bytes_1.toBuffer(d);\n      });\n    } else if (typeof data === 'object') {\n      var keys_1 = Object.keys(data);\n      fields.forEach(function (field) {\n        if (keys_1.indexOf(field.name) !== -1) self[field.name] = data[field.name];\n        if (keys_1.indexOf(field.alias) !== -1) self[field.alias] = data[field.alias];\n      });\n    } else {\n      throw new Error('invalid data');\n    }\n  }\n};","map":{"version":3,"names":["assert","require","ethjsUtil","rlp","bytes_1","exports","defineProperties","self","fields","data","raw","_fields","toJSON","label","obj_1","forEach","field","toString","baToJSON","serialize","encode","i","push","name","getter","setter","v","toBuffer","allowZero","Buffer","allocUnsafe","allowLess","length","stripZeros","Object","defineProperty","enumerable","configurable","get","set","default","alias","from","stripHexPrefix","isBuffer","decode","Array","isArray","Error","d","keys_1","keys","indexOf"],"sources":["../src/object.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script"}